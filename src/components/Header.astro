---
import "../styles/global.css";

const today = new Date().toLocaleDateString('en-US', {
  weekday: 'long',
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});
---

<header class="bg-white shadow-sm border-b border-gray-200 px-6 py-4">
  <div class="flex justify-between items-center">
    <div>
      <h1 class="text-2xl font-bold text-gray-800">TaskFlow</h1>
      <p class="text-gray-500 text-sm mt-1">{today}</p>
    </div>
    <div class="flex items-center space-x-4">
      <div class="relative">
        <input 
          type="text" 
          id="searchInput"
          placeholder="Search tasks..." 
          class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        />
        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
      </div>
      <button 
        id="newTaskBtn"
        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition duration-200"
      >
        <i class="fas fa-plus mr-2"></i>New Task
      </button>
      <div class="relative">
        <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold cursor-pointer">
          JD
        </div>
      </div>
    </div>
  </div>
</header>

<script>
  // Handle New Task Button Click
  document.addEventListener('DOMContentLoaded', () => {
    const newTaskBtn = document.getElementById('newTaskBtn');
    const searchInput = document.getElementById('searchInput');
    
    if (newTaskBtn) {
      newTaskBtn.addEventListener('click', () => {
        // Show the task form modal or scroll to it
        const taskForm = document.getElementById('taskFormSection');
        if (taskForm) {
          taskForm.scrollIntoView({ behavior: 'smooth' });
          // Add animation class
          taskForm.classList.add('fade-in');
        } else {
          // Create and show a modal if task form is not on page
          showTaskModal();
        }
      });
    }
    
    if (searchInput) {
      searchInput.addEventListener('input', (e) => {
        const searchTerm = e.target.value.toLowerCase();
        // Filter tasks based on search term
        filterTasks(searchTerm);
      });
    }
    
    function showTaskModal() {
      // Create modal HTML
      const modalHTML = `
        <div id="taskModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-xl font-bold">Create New Task</h3>
              <button id="closeModal" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <form id="modalTaskForm">
              <div class="mb-4">
                <input type="text" placeholder="Task Title" class="w-full px-4 py-2 border rounded-lg" required>
              </div>
              <div class="mb-4">
                <textarea placeholder="Description" rows="3" class="w-full px-4 py-2 border rounded-lg"></textarea>
              </div>
              <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                Create Task
              </button>
            </form>
          </div>
        </div>
      `;
      
      // Add modal to page
      document.body.insertAdjacentHTML('beforeend', modalHTML);
      
      // Add event listeners for modal
      document.getElementById('closeModal').addEventListener('click', closeModal);
      document.getElementById('modalTaskForm').addEventListener('submit', handleTaskSubmit);
      document.getElementById('taskModal').addEventListener('click', (e) => {
        if (e.target.id === 'taskModal') closeModal();
      });
    }
    
    function closeModal() {
      const modal = document.getElementById('taskModal');
      if (modal) modal.remove();
    }
    
    function handleTaskSubmit(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const taskData = {
        title: formData.get('title'),
        description: formData.get('description'),
        createdAt: new Date().toISOString()
      };
      
      // Here you would normally send this to a backend
      console.log('New task:', taskData);
      alert('Task created successfully!');
      closeModal();
    }
    
    function filterTasks(searchTerm) {
      const taskItems = document.querySelectorAll('.task-item');
      taskItems.forEach(task => {
        const title = task.querySelector('.task-title').textContent.toLowerCase();
        const description = task.querySelector('.task-description').textContent.toLowerCase();
        
        if (title.includes(searchTerm) || description.includes(searchTerm)) {
          task.style.display = 'block';
        } else {
          task.style.display = 'none';
        }
      });
    }
  });
</script>